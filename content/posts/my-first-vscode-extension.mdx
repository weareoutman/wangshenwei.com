---
title: æˆ‘çš„ç¬¬ä¸€ä¸ª VS Code æ‰©å±•
date: 2020-02-29
---

åœ¨å·¥ä½œä¸­çš„ä¸€ä¸ªé¡¹ç›®é‡Œï¼Œæˆ‘ä»¬ä¸ºé™æ€å£°æ˜å¼çš„é…ç½®æ–‡ä»¶ï¼ˆJSONï¼‰æ·»åŠ äº†ä¸€ä¸ªåœ¨è¿è¡Œæ—¶å¤„ç†åŠ¨æ€æ•°æ®çš„èƒ½åŠ›ã€‚

æˆ‘ä»¬å°è¯•åœ¨ JSON çš„å­—ç¬¦ä¸²ä¸­æ‰©å±•äº†ç±»ä¼¼ JS çš„[æ¨¡æ¿å­—ç¬¦ä¸²]èƒ½åŠ›ï¼Œé…ç½®å½¢å¼å¤§çº¦å¦‚ä¸‹ï¼š

```json
{
  "brick": "my-brick",
  "properties": {
    "sort": "${QUERY.sort = hostname}",
    "states": "${QUERY.states = [1, 2]}",
    "from": "?from=${HASH | substr: 1}"
  },
  "transform": {
    "users": "@{owners = {} | values | compact}"
  }
}
```

å…¶ä¸­è¢« `${...}` åŒ…è£¹åµŒå…¥çš„è¡¨è¾¾å¼å°†åœ¨è¿è¡Œæ—¶è¢«è§£æï¼Œå¹¶æ ¹æ®ä¸Šä¸‹æ–‡ä¿¡æ¯è®¡ç®—å¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚å¼€å‘è€…å¯ä»¥åœ¨è¿™ä¸ªè¡¨è¾¾å¼ä¸­å¡«å…¥ä½¿ç”¨çš„æ•°æ®å­—æ®µï¼ŒæŒ‡å®šå½“åŸå§‹æ•°æ®ä¸ºç©ºæ—¶åº”ä½¿ç”¨çš„é»˜è®¤å€¼ï¼Œè®¾ç½®ç®¡é“å’Œå¯é€‰å‚æ•°å¯¹æ•°æ®è¿›è¡ŒåŠ å·¥ï¼Œå¹¶ä¸”å…è®¸ç»™é»˜è®¤å€¼ã€å‚æ•°ç­‰è®¾ç½®æ•°ç»„æˆ–å­—å…¸è¿™æ ·çš„å¤åˆæ•°æ®ç»“æ„ã€‚

ç”±äºæ•°ç»„æˆ–å­—å…¸è¿™æ ·çš„è¡¨è¾¾å¼å†…éƒ¨åŒ…å«äº†æ‹¬å·å¹³è¡¡ï¼Œè¦è§£æè¿™ä¸ªåµŒå…¥å¼è¯­æ³•è¶…å‡ºäº†ä¼ ç»Ÿçš„æ­£åˆ™è¡¨è¾¾å¼çš„èƒ½åŠ›èŒƒç•´ï¼Œå› æ­¤æˆ‘ä»¬æœ‰å¿…è¦ä¸ºå®ƒè®¾è®¡ä¸€å¥—ä¸¥ç‘¾çš„è¯­æ³•ã€‚

ä¸ºäº†èƒ½æ–¹ä¾¿åœ°ç¼–è¯‘è¿™å¥—è¯­æ³•ï¼Œå®ƒåº”è¯¥æ˜¯[ä¸Šä¸‹æ–‡æ— å…³]çš„ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨ [EBNF] è®¾è®¡æˆ‘ä»¬çš„è¯­æ³•å¦‚ä¸‹ï¼š

```ebnf
InjectableString
         ::= ( Placeholder | RawString )*

Placeholder
         ::= '${' Field Default? Pipes? '}'

Default  ::= '=' JsonValueOrLiteral

Pipes    ::= ( '|' Pipe )+

Pipe     ::= Identifier ( ':' JsonValueOrLiteral )*

JsonValueOrLiteral
         ::= JsonValue | Literal
```

é€šè¿‡ä¸€ä¸ªåœ¨çº¿å·¥å…· [Railroad Diagram Generator] å¯ä»¥å°†è¯­æ³•çš„ç»“æ„å¯è§†åŒ–å‡ºæ¥ï¼š

![Grammar Diagram](../assets/my-first-vscode-extension/grammar.png)

è¯­æ³•è®¾è®¡å¥½äº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å®ç°å®ƒçš„ç¼–è¯‘å™¨äº†ï¼Œå‚è€ƒæ•™ç¨‹ *[Compiler Design Tutorial]* ä¾æ¬¡å®ç°[è¯æ³•åˆ†æ]å’Œ[è¯­æ³•åˆ†æ]ã€‚å…·ä½“çš„æ–¹æ¡ˆè¿™é‡Œä¸å†èµ˜è¿°ï¼Œæ— å¤–ä¹é€šè¿‡æ­£åˆ™åŒ¹é…å–å¾— *Token* åˆ—è¡¨ï¼Œç„¶åä½¿ç”¨[è‡ªåŠ¨æœº]åˆ†æç”Ÿæˆè¯­æ³•æ ‘ï¼Œæœ€åç³»ç»Ÿæ ¹æ®è¯­æ³•æ ‘è¿è¡Œä»£ç ã€‚

è¿™å¥—è¯­æ³•è™½ç„¶çœ‹ä¸Šå»éå¸¸ç®€å•ï¼Œä½†å®ƒå·²ç»èƒ½æ»¡è¶³å½“ä¸‹çš„éœ€æ±‚ï¼Œå¼€å‘è€…ç†è§£æ¥ä¹Ÿå¹¶ä¸è´¹åŠ›ã€‚ä¸è¿‡æœ‰ä¸€ä¸ªç¼ºç‚¹æ˜¯è¿™äº›åµŒå…¥çš„è¡¨è¾¾å¼æ— æ³•è¢« IDE è¯†åˆ«å¹¶è¿›è¡Œè¯­æ³•é«˜äº®ï¼Œå®ƒä»¬åªæ˜¯ä¸€ä¸²å­—ç¬¦ä¸²ã€‚

ä¼—æ‰€å‘¨çŸ¥ï¼Œä»£ç è¯­æ³•é«˜äº®æ˜¯ç¨‹åºå¼€å‘çš„åŸºæœ¬è¦æ±‚ï¼Œåœ¨*é©¬æ–¯æ´›éœ€æ±‚å±‚æ¬¡ç†è®º*ä¸­å±äºæœ€åŸºæœ¬çš„*ç”Ÿç†éœ€æ±‚*ã€‚å¥½åœ¨ä»¥ VS Code ä¸ºé¦–çš„ç°ä»£ä»£ç ç¼–è¾‘å™¨çš„ä¼˜ç§€çš„å¯æ‰©å±•èƒ½åŠ›ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ä¸ºè¿™å¥—åˆšå‡ºç‚‰çš„è¯­æ³•å®ç°ä¸€ä¸ªè¯­æ³•é«˜äº®æ‰©å±•ã€‚

> å…³äºå¦‚ä½•å¼€å§‹ç¼–å†™ VS Code æ‰©å±•è¯·å‚è€ƒ[å®˜æ–¹æ–‡æ¡£]ã€‚å§‹ç»ˆä¼˜å…ˆè€ƒè™‘ç¬¬ä¸€æ‰‹èµ„æ–™ï¼Œæˆ‘è¿™é‡Œçš„æˆ–è€…åˆ«äººçš„äºŒæ‰‹èµ„æ–™éšæ—¶å¯èƒ½è¿‡æ—¶ã€‚

æ ¹æ®ç§‘å­¦è€Œè¯¦å°½çš„å®˜æ–¹æ–‡æ¡£æŒ‡å¼•ï¼Œæ–°æ‰©å±•çš„ç¼–å†™æŒ‰éƒ¨å°±ç­ï¼š

1. [ä½¿ç”¨è„šæ‰‹æ¶å·¥å…·æ–°å»ºé¡¹ç›®](https://code.visualstudio.com/api/get-started/your-first-extension)ï¼›
2. æ ¹æ®[è¯­æ³•é«˜äº®æŒ‡å¼•]ï¼Œè¿™å¥—æ–°è¯­æ³•é€‚ç”¨äº [Injection Grammars]ï¼›
4. å°†æ–°è¯­æ³•æ”¹å†™æˆ VS Code ä½¿ç”¨çš„ [TextMate Grammars]ï¼›
5. æœ¬åœ°è°ƒè¯•ï¼Œæœ€åå®Œæˆ[å‘å¸ƒ]ã€‚

å…¶ä¸­æ²¡æœ‰å¤ªå¤šçš„å›°éš¾ï¼Œä¸»è¦çš„å·¥ä½œé›†ä¸­åœ¨ç¼–å†™ TextMate Grammars ä¸Šï¼Œä½†å¥½åœ¨æˆ‘ä»¬éµå¾ªäº†ç›¸å¯¹æ ‡å‡†çš„è®¾è®¡ï¼Œå¯ä»¥è½»æ¾åœ°åˆ©ç”¨ä¹‹å‰ç”Ÿæˆçš„è¯­æ³•è®¾è®¡å›¾ã€è¯æ³•å’Œè¯­æ³•åˆ†æä»£ç è½¬æ¢æˆ TextMate Grammarsã€‚

åœ¨è¿™ä¸ªæ‰©å±•çš„åŠ æŒä¸‹ï¼Œæˆ‘ä»¬çš„åµŒå…¥å¼ä»£ç ç»ˆäºå˜å¾—çµåŠ¨èµ·æ¥ã€‚

![Sample](../assets/my-first-vscode-extension/sample.png)

<hr class="divider" />

[Brick Next Support] å‘å¸ƒä¸€å¤©ï¼Œå–œè·ä¸€æ¡äº”æ˜Ÿå¥½è¯„å’Œåä¸€æ¬¡ä¸‹è½½ ğŸ‘ã€‚

![Screenshot](../assets/my-first-vscode-extension/screenshot.png)

[æ¨¡æ¿å­—ç¬¦ä¸²]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals
[ä¸Šä¸‹æ–‡æ— å…³]: https://en.wikipedia.org/wiki/Context-free_grammar
[EBNF]: https://en.wikipedia.org/wiki/EBNF
[Railroad Diagram Generator]: https://www.bottlecaps.de/rr/ui
[Compiler Design Tutorial]: https://www.tutorialspoint.com/compiler_design/index.htm
[è¯æ³•åˆ†æ]: https://www.tutorialspoint.com/compiler_design/compiler_design_lexical_analysis.htm
[è¯­æ³•åˆ†æ]: https://www.tutorialspoint.com/compiler_design/compiler_design_syntax_analysis.htm
[è‡ªåŠ¨æœº]: https://en.wikipedia.org/wiki/Automata_theory
[å®˜æ–¹æ–‡æ¡£]: https://code.visualstudio.com/api
[è¯­æ³•é«˜äº®æŒ‡å¼•]: https://code.visualstudio.com/api/language-extensions/syntax-highlight-guide
[Injection Grammars]: https://code.visualstudio.com/api/language-extensions/syntax-highlight-guide#injection-grammars
[TextMate Grammars]: https://macromates.com/manual/en/language_grammars
[å‘å¸ƒ]: https://code.visualstudio.com/api/working-with-extensions/publishing-extension
[Brick Next Support]: https://marketplace.visualstudio.com/items?itemName=weareoutman.vscode-brick-next
